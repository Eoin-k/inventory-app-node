<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<link rel="stylesheet" href="/styles.css" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title><%= item.item_name %></title>
	</head>
	<body>
		<div class="header-wrapper container">
			<div class="heading-wrapper">
				<%- include("partials/errors.ejs") %>
				<h1><%= item.item_name %></h1>
				<a href="/">clear filters</a>
				<a href="/additem">add new item</a>
				<a href="/addmanufacturer">add new manufacturer</a>
			</div>
		</div>
		<div class="body-wrapper">
			<div class="sidebar">
				<% categories.forEach(category => { %>
				<div class="cat-card">
					<p><%= category.cat_name %></p>
					<a href="/cat/<%= category.id%>">Show related parts</a>
				</div>
				<% }); %>
				<div class="manufacturer-list">
					<% manufacturers.forEach(manufacturer => { %>
					<div class="manufacturer-card">
						<p><%= manufacturer.manufacturer_name %></p>
						<a href="/manufacturer/<%= manufacturer.manufacturer_id %>"
							>Show <%= manufacturer.manufacturer_name %> parts</a
						>
					</div>
					<% }); %>
				</div>
			</div>
			<div class="main-wrapper">
				<div class="item-hero">
					<img src="<%= item.item_image %>" alt="" />
					<a href="/item/<%= item.id %>"><h3><%= item.item_name %></h3></a>
					<p>Stock Level:<%= item.item_quantity %></p>
					<p>For <%= item.manufacturer_name %> models</p>
				</div>
				<div class="item-description">
					<p><%= item.item_description %></p>
				</div>
				<button id="showbtn">Edit Item</button>
				<dialog id="edit-item-dialog">
					<div class="item-form-wrapper">
						<p>Edit Item details: only edit fields that need to be updated</p>
						<form action="/item/<%= item.id %>" method="POST">
							<input type="hidden" name="id" id="id" value="<%= item.id %>" />
							<label for="itemname">
								<p>Item name:</p>
								<input
									type="text"
									id="itemname"
									name="itemname"
									value="<%=item.item_name %>"
									required
								/>
							</label>
							<label for="itemqty">
								<p>Enter quantity:</p>
								<input
									type="number"
									value="<%=item.item_quantity %>"
									id="itemqty"
									name="itemqty"
								/>
							</label>
							<label for="itemimage">
								<p>Enter image Url for item</p>
								<input
									type="text"
									value="<%=item.item_image %> "
									id="itemimage"
									name="itemimage"
								/>
							</label>
							<label for="itemdescription">
								<p>Enter item description</p>
								<textarea name="itemdescription" id="itemdescription">
<%= item.item_description %></textarea
								>
							</label>
							<label for="manufacturer">
								<p>Select manufacturer this part is for:</p>
								<select id="manufacturer" name="manufacturer">
									<% manufacturers.forEach(manufacturer => { %> <%
									if(item.manufacturer_id == manufacturer.manufacturer_id) { %>
									<option value="<%=manufacturer.manufacturer_id %>" selected>
										<%= manufacturer.manufacturer_name %>
									</option>
									<% } else { %>
									<option value="<%=manufacturer.manufacturer_id %>">
										<%= manufacturer.manufacturer_name %>
									</option>
									<%} %> <% }); %>
								</select>
							</label>
							<label for="category">
								<p>Select part category:</p>
								<select id="category" name="category">
									<% categories.forEach(cat => { %> <% if(item.category_id ==
									cat.id) { %>
									<option value="<%= cat.id %>" selected>
										<%= cat.cat_name %>
									</option>
									<% } else { %>
									<option value="<%= cat.id %>"><%= cat.cat_name %></option>
									<% } %> <% }); %>
								</select>
							</label>
							<button id="item-update" type="submit">Update Product</button>
						</form>
					</div>
				</dialog>
			</div>
		</div>
		<script>
			const showButton = document.getElementById("showbtn");
			const dialog = document.getElementById("edit-item-dialog");
			showButton.addEventListener("click", () => {
				dialog.showModal();
			});
		</script>
	</body>
</html>
